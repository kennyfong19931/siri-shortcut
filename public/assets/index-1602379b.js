(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();/*!
 * Color mode toggler for Bootstrap's docs (https://getbootstrap.com/)
 * Copyright 2011-2023 The Bootstrap Authors
 * Licensed under the Creative Commons Attribution 3.0 Unported License.
 */(()=>{const n=()=>localStorage.getItem("theme"),t=r=>localStorage.setItem("theme",r),e=()=>{const r=n();return r||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")},o=r=>{r==="auto"&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-bs-theme","dark"):document.documentElement.setAttribute("data-bs-theme",r)};o(e());const i=(r,a=!1)=>{const s=document.querySelector("#bd-theme");if(!s)return;const l=document.querySelector("#bd-theme-text"),c=document.querySelector(".theme-icon-active use"),d=document.querySelector(`[data-bs-theme-value="${r}"]`),f=d.querySelector("svg use").getAttribute("href");document.querySelectorAll("[data-bs-theme-value]").forEach(_=>{_.classList.remove("active"),_.setAttribute("aria-pressed","false")}),d.classList.add("active"),d.setAttribute("aria-pressed","true"),c.setAttribute("href",f);const m=`${l.textContent} (${d.dataset.bsThemeValue})`;s.setAttribute("aria-label",m),a&&s.focus()};window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{const r=n();r!=="light"&&r!=="dark"&&o(e())}),window.addEventListener("DOMContentLoaded",()=>{i(e()),document.querySelectorAll("[data-bs-theme-value]").forEach(r=>{r.addEventListener("click",()=>{const a=r.getAttribute("data-bs-theme-value");t(a),o(a),i(a,!0)})})})})();const rt=new Map,se={set(n,t,e){rt.has(n)||rt.set(n,new Map);const o=rt.get(n);if(!o.has(t)&&o.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(o.keys())[0]}.`);return}o.set(t,e)},get(n,t){return rt.has(n)&&rt.get(n).get(t)||null},remove(n,t){if(!rt.has(n))return;const e=rt.get(n);e.delete(t),e.size===0&&rt.delete(n)}},co=1e3,we="transitionend",vn=n=>(n&&window.CSS&&window.CSS.escape&&(n=n.replace(/#([^\s"#']+)/g,(t,e)=>`#${CSS.escape(e)}`)),n),uo=n=>n==null?`${n}`:Object.prototype.toString.call(n).match(/\s([a-z]+)/i)[1].toLowerCase(),fo=n=>{if(!n)return 0;let{transitionDuration:t,transitionDelay:e}=window.getComputedStyle(n);const o=Number.parseFloat(t),i=Number.parseFloat(e);return!o&&!i?0:(t=t.split(",")[0],e=e.split(",")[0],(Number.parseFloat(t)+Number.parseFloat(e))*co)},ho=n=>{n.dispatchEvent(new Event(we))},wt=n=>!n||typeof n!="object"?!1:(typeof n.jquery<"u"&&(n=n[0]),typeof n.nodeType<"u"),Se=n=>wt(n)?n.jquery?n[0]:n:typeof n=="string"&&n.length>0?document.querySelector(vn(n)):null,Ie=n=>{if(!wt(n)||n.getClientRects().length===0)return!1;const t=getComputedStyle(n).getPropertyValue("visibility")==="visible",e=n.closest("details:not([open])");if(!e)return t;if(e!==n){const o=n.closest("summary");if(o&&o.parentNode!==e||o===null)return!1}return t},Be=n=>!n||n.nodeType!==Node.ELEMENT_NODE||n.classList.contains("disabled")?!0:typeof n.disabled<"u"?n.disabled:n.hasAttribute("disabled")&&n.getAttribute("disabled")!=="false",En=n=>{n.offsetHeight},_n=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,le=[],po=n=>{document.readyState==="loading"?(le.length||document.addEventListener("DOMContentLoaded",()=>{for(const t of le)t()}),le.push(n)):n()},Ge=()=>document.documentElement.dir==="rtl",yn=n=>{po(()=>{const t=_n();if(t){const e=n.NAME,o=t.fn[e];t.fn[e]=n.jQueryInterface,t.fn[e].Constructor=n,t.fn[e].noConflict=()=>(t.fn[e]=o,n.jQueryInterface)}})},gt=(n,t=[],e=n)=>typeof n=="function"?n(...t):e,wn=(n,t,e=!0)=>{if(!e){gt(n);return}const o=5,i=fo(t)+o;let r=!1;const a=({target:s})=>{s===t&&(r=!0,t.removeEventListener(we,a),gt(n))};t.addEventListener(we,a),setTimeout(()=>{r||ho(t)},i)},mo=/[^.]*(?=\..*)\.|.*/,go=/\..*/,bo=/::\d+$/,ce={};let ze=1;const Sn={mouseenter:"mouseover",mouseleave:"mouseout"},vo=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function Dn(n,t){return t&&`${t}::${ze++}`||n.uidEvent||ze++}function An(n){const t=Dn(n);return n.uidEvent=t,ce[t]=ce[t]||{},ce[t]}function Eo(n,t){return function e(o){return Le(o,{delegateTarget:n}),e.oneOff&&E.off(n,o.type,t),t.apply(n,[o])}}function _o(n,t,e){return function o(i){const r=n.querySelectorAll(t);for(let{target:a}=i;a&&a!==this;a=a.parentNode)for(const s of r)if(s===a)return Le(i,{delegateTarget:a}),o.oneOff&&E.off(n,i.type,t,e),e.apply(a,[i])}}function kn(n,t,e=null){return Object.values(n).find(o=>o.callable===t&&o.delegationSelector===e)}function Tn(n,t,e){const o=typeof t=="string",i=o?e:t||e;let r=Cn(n);return vo.has(r)||(r=n),[o,i,r]}function Ke(n,t,e,o,i){if(typeof t!="string"||!n)return;let[r,a,s]=Tn(t,e,o);t in Sn&&(a=(v=>function(b){if(!b.relatedTarget||b.relatedTarget!==b.delegateTarget&&!b.delegateTarget.contains(b.relatedTarget))return v.call(this,b)})(a));const l=An(n),c=l[s]||(l[s]={}),d=kn(c,a,r?e:null);if(d){d.oneOff=d.oneOff&&i;return}const f=Dn(a,t.replace(mo,"")),m=r?_o(n,e,a):Eo(n,a);m.delegationSelector=r?e:null,m.callable=a,m.oneOff=i,m.uidEvent=f,c[f]=m,n.addEventListener(s,m,r)}function De(n,t,e,o,i){const r=kn(t[e],o,i);r&&(n.removeEventListener(e,r,!!i),delete t[e][r.uidEvent])}function yo(n,t,e,o){const i=t[e]||{};for(const[r,a]of Object.entries(i))r.includes(o)&&De(n,t,e,a.callable,a.delegationSelector)}function Cn(n){return n=n.replace(go,""),Sn[n]||n}const E={on(n,t,e,o){Ke(n,t,e,o,!1)},one(n,t,e,o){Ke(n,t,e,o,!0)},off(n,t,e,o){if(typeof t!="string"||!n)return;const[i,r,a]=Tn(t,e,o),s=a!==t,l=An(n),c=l[a]||{},d=t.startsWith(".");if(typeof r<"u"){if(!Object.keys(c).length)return;De(n,l,a,r,i?e:null);return}if(d)for(const f of Object.keys(l))yo(n,l,f,t.slice(1));for(const[f,m]of Object.entries(c)){const _=f.replace(bo,"");(!s||t.includes(_))&&De(n,l,a,m.callable,m.delegationSelector)}},trigger(n,t,e){if(typeof t!="string"||!n)return null;const o=_n(),i=Cn(t),r=t!==i;let a=null,s=!0,l=!0,c=!1;r&&o&&(a=o.Event(t,e),o(n).trigger(a),s=!a.isPropagationStopped(),l=!a.isImmediatePropagationStopped(),c=a.isDefaultPrevented());const d=Le(new Event(t,{bubbles:s,cancelable:!0}),e);return c&&d.preventDefault(),l&&n.dispatchEvent(d),d.defaultPrevented&&a&&a.preventDefault(),d}};function Le(n,t={}){for(const[e,o]of Object.entries(t))try{n[e]=o}catch{Object.defineProperty(n,e,{configurable:!0,get(){return o}})}return n}function Xe(n){if(n==="true")return!0;if(n==="false")return!1;if(n===Number(n).toString())return Number(n);if(n===""||n==="null")return null;if(typeof n!="string")return n;try{return JSON.parse(decodeURIComponent(n))}catch{return n}}function ue(n){return n.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}const Lt={setDataAttribute(n,t,e){n.setAttribute(`data-bs-${ue(t)}`,e)},removeDataAttribute(n,t){n.removeAttribute(`data-bs-${ue(t)}`)},getDataAttributes(n){if(!n)return{};const t={},e=Object.keys(n.dataset).filter(o=>o.startsWith("bs")&&!o.startsWith("bsConfig"));for(const o of e){let i=o.replace(/^bs/,"");i=i.charAt(0).toLowerCase()+i.slice(1,i.length),t[i]=Xe(n.dataset[o])}return t},getDataAttribute(n,t){return Xe(n.getAttribute(`data-bs-${ue(t)}`))}};class Pe{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,e){const o=wt(e)?Lt.getDataAttribute(e,"config"):{};return{...this.constructor.Default,...typeof o=="object"?o:{},...wt(e)?Lt.getDataAttributes(e):{},...typeof t=="object"?t:{}}}_typeCheckConfig(t,e=this.constructor.DefaultType){for(const[o,i]of Object.entries(e)){const r=t[o],a=wt(r)?"element":uo(r);if(!new RegExp(i).test(a))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${o}" provided type "${a}" but expected type "${i}".`)}}}const wo="5.3.0";class Nn extends Pe{constructor(t,e){super(),t=Se(t),t&&(this._element=t,this._config=this._getConfig(e),se.set(this._element,this.constructor.DATA_KEY,this))}dispose(){se.remove(this._element,this.constructor.DATA_KEY),E.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,e,o=!0){wn(t,e,o)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return se.get(Se(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,typeof e=="object"?e:null)}static get VERSION(){return wo}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const de=n=>{let t=n.getAttribute("data-bs-target");if(!t||t==="#"){let e=n.getAttribute("href");if(!e||!e.includes("#")&&!e.startsWith("."))return null;e.includes("#")&&!e.startsWith("#")&&(e=`#${e.split("#")[1]}`),t=e&&e!=="#"?e.trim():null}return vn(t)},P={find(n,t=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(t,n))},findOne(n,t=document.documentElement){return Element.prototype.querySelector.call(t,n)},children(n,t){return[].concat(...n.children).filter(e=>e.matches(t))},parents(n,t){const e=[];let o=n.parentNode.closest(t);for(;o;)e.push(o),o=o.parentNode.closest(t);return e},prev(n,t){let e=n.previousElementSibling;for(;e;){if(e.matches(t))return[e];e=e.previousElementSibling}return[]},next(n,t){let e=n.nextElementSibling;for(;e;){if(e.matches(t))return[e];e=e.nextElementSibling}return[]},focusableChildren(n){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(e=>`${e}:not([tabindex^="-"])`).join(",");return this.find(t,n).filter(e=>!Be(e)&&Ie(e))},getSelectorFromElement(n){const t=de(n);return t&&P.findOne(t)?t:null},getElementFromSelector(n){const t=de(n);return t?P.findOne(t):null},getMultipleElementsFromSelector(n){const t=de(n);return t?P.find(t):[]}},On="backdrop",So="fade",qe="show",Ue=`mousedown.bs.${On}`,Do={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Ao={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class In extends Pe{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return Do}static get DefaultType(){return Ao}static get NAME(){return On}show(t){if(!this._config.isVisible){gt(t);return}this._append();const e=this._getElement();this._config.isAnimated&&En(e),e.classList.add(qe),this._emulateAnimation(()=>{gt(t)})}hide(t){if(!this._config.isVisible){gt(t);return}this._getElement().classList.remove(qe),this._emulateAnimation(()=>{this.dispose(),gt(t)})}dispose(){this._isAppended&&(E.off(this._element,Ue),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add(So),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=Se(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),E.on(t,Ue,()=>{gt(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(t){wn(t,this._getElement(),this._config.isAnimated)}}const Bn=(n,t="hide")=>{const e=`click.dismiss${n.EVENT_KEY}`,o=n.NAME;E.on(document,e,`[data-bs-dismiss="${o}"]`,function(i){if(["A","AREA"].includes(this.tagName)&&i.preventDefault(),Be(this))return;const r=P.getElementFromSelector(this)||this.closest(`.${o}`);n.getOrCreateInstance(r)[t]()})},ko="focustrap",To="bs.focustrap",Zt=`.${To}`,Co=`focusin${Zt}`,No=`keydown.tab${Zt}`,Oo="Tab",Io="forward",Je="backward",Bo={autofocus:!0,trapElement:null},Lo={autofocus:"boolean",trapElement:"element"};class Ln extends Pe{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Bo}static get DefaultType(){return Lo}static get NAME(){return ko}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),E.off(document,Zt),E.on(document,Co,t=>this._handleFocusin(t)),E.on(document,No,t=>this._handleKeydown(t)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,E.off(document,Zt))}_handleFocusin(t){const{trapElement:e}=this._config;if(t.target===document||t.target===e||e.contains(t.target))return;const o=P.focusableChildren(e);o.length===0?e.focus():this._lastTabNavDirection===Je?o[o.length-1].focus():o[0].focus()}_handleKeydown(t){t.key===Oo&&(this._lastTabNavDirection=t.shiftKey?Je:Io)}}const Qe=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Ze=".sticky-top",Wt="padding-right",tn="margin-right";class Ae{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Wt,e=>e+t),this._setElementAttributes(Qe,Wt,e=>e+t),this._setElementAttributes(Ze,tn,e=>e-t)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Wt),this._resetElementAttributes(Qe,Wt),this._resetElementAttributes(Ze,tn)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,e,o){const i=this.getWidth(),r=a=>{if(a!==this._element&&window.innerWidth>a.clientWidth+i)return;this._saveInitialAttribute(a,e);const s=window.getComputedStyle(a).getPropertyValue(e);a.style.setProperty(e,`${o(Number.parseFloat(s))}px`)};this._applyManipulationCallback(t,r)}_saveInitialAttribute(t,e){const o=t.style.getPropertyValue(e);o&&Lt.setDataAttribute(t,e,o)}_resetElementAttributes(t,e){const o=i=>{const r=Lt.getDataAttribute(i,e);if(r===null){i.style.removeProperty(e);return}Lt.removeDataAttribute(i,e),i.style.setProperty(e,r)};this._applyManipulationCallback(t,o)}_applyManipulationCallback(t,e){if(wt(t)){e(t);return}for(const o of P.find(t,this._element))e(o)}}const Po="offcanvas",$o="bs.offcanvas",et=`.${$o}`,Pn=".data-api",Mo=`load${et}${Pn}`,xo="Escape",en="show",nn="showing",on="hiding",Ro="offcanvas-backdrop",$n=".offcanvas.show",Fo=`show${et}`,Ho=`shown${et}`,Yo=`hide${et}`,rn=`hidePrevented${et}`,Mn=`hidden${et}`,Wo=`resize${et}`,Vo=`click${et}${Pn}`,jo=`keydown.dismiss${et}`,Go='[data-bs-toggle="offcanvas"]',zo={backdrop:!0,keyboard:!0,scroll:!1},Ko={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Z extends Nn{constructor(t,e){super(t,e),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return zo}static get DefaultType(){return Ko}static get NAME(){return Po}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||E.trigger(this._element,Fo,{relatedTarget:t}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new Ae().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(nn);const o=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(en),this._element.classList.remove(nn),E.trigger(this._element,Ho,{relatedTarget:t})};this._queueCallback(o,this._element,!0)}hide(){if(!this._isShown||E.trigger(this._element,Yo).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(on),this._backdrop.hide();const e=()=>{this._element.classList.remove(en,on),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new Ae().reset(),E.trigger(this._element,Mn)};this._queueCallback(e,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=()=>{if(this._config.backdrop==="static"){E.trigger(this._element,rn);return}this.hide()},e=!!this._config.backdrop;return new In({className:Ro,isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?t:null})}_initializeFocusTrap(){return new Ln({trapElement:this._element})}_addEventListeners(){E.on(this._element,jo,t=>{if(t.key===xo){if(this._config.keyboard){this.hide();return}E.trigger(this._element,rn)}})}static jQueryInterface(t){return this.each(function(){const e=Z.getOrCreateInstance(this,t);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}E.on(document,Vo,Go,function(n){const t=P.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),Be(this))return;E.one(t,Mn,()=>{Ie(this)&&this.focus()});const e=P.findOne($n);e&&e!==t&&Z.getInstance(e).hide(),Z.getOrCreateInstance(t).toggle(this)});E.on(window,Mo,()=>{for(const n of P.find($n))Z.getOrCreateInstance(n).show()});E.on(window,Wo,()=>{for(const n of P.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(n).position!=="fixed"&&Z.getOrCreateInstance(n).hide()});Bn(Z);yn(Z);function $e(n){return window.btoa(unescape(encodeURIComponent(n)))}function re(n){return decodeURIComponent(escape(window.atob(n)))}function Me(n){return`/img/${n}.svg`}function ke(n){let t=document.createElement("template");return n=n.trim(),t.innerHTML=n,t.content.firstChild}const Xo="/api/route/{route}.json",qo="/api/spatial/{path}.json",Uo="/api/eta",Jo="/update.json",xn=document.getElementById("searchAlert"),Vt=document.getElementById("searchResult"),Rn=new Z("#searchDrawer"),Qo="https://mapapi.geodata.gov.hk/gs/api/v1.0.0/xyz/basemap/wgs84/{z}/{x}/{y}.png",Zo="https://mapapi.geodata.gov.hk/gs/api/v1.0.0/xyz/imagery/wgs84/{z}/{x}/{y}.png",ti="https://mapapi.geodata.gov.hk/gs/api/v1.0.0/xyz/label/hk/tc/wgs84/{z}/{x}/{y}.png",xe='<a target="_blank" href="https://portal.csdi.gov.hk/">&copy; 地圖版權屬香港特區政府</a><img style="width:16px;height:16px;" src="https://api.hkmapservice.gov.hk/mapapi/landsdlogo.jpg" />',an={delay:400,dashArray:[20,40],weight:5,paused:!1,reverse:!1,hardwareAccelerated:!0},ei=(n,t)=>{let e=`<div class="alert alert-${t}" role="alert"><div>${n}</div></div>`;xn.innerHTML+=e},ni=()=>{xn.innerHTML=""},oi=()=>{ni(),Vt.innerHTML='<ul class="list-group placeholder-glow"><li class="list-group-item"><span class="placeholder col-12"></span></li><li class="list-group-item"><span class="placeholder col-12"></span></li></ul>';let n=document.getElementById("routeInput").value.toUpperCase();fetch(Xo.replace("{route}",n)).then(t=>t.json()).then(t=>{Vt.innerHTML="",t.forEach((e,o)=>{let i=`<div class="d-flex align-items-center list-group-item list-group-item-action" id="route-${o}" onclick="renderRoute('route-${o}', '${$e(JSON.stringify(e))}')"><div class="flex-shrink-0"><img class="logo" src="${Me(e.company)}" alt="${e.company}"/></div><div class="flex-grow-1 ms-3">${e.orig}➡️${e.dest}</div></div>`;Vt.innerHTML+=i})}).catch(function(t){console.log(t),ei(`Cannot find route ${n} !`,"danger"),Vt.innerHTML=""})},ii=(n,t)=>{Array.from(document.getElementsByClassName("list-group-item")).forEach(function(a){a.classList.remove("active")}),document.getElementById(n).classList.add("active");const e=JSON.parse(re(t));K.clearLayers(),e.stopList.forEach(a=>{const s={bookmarked:!1,company:e.company,route:e.route,routeId:e.routeId,routeType:e.routeType,routeOrig:e.orig,routeDest:e.dest,dir:e.dir,stop:a.id,name:a.name,lat:a.lat,long:a.long,street:a.street,fare:a.fare,fareHoliday:a.fareHoliday};var l=L.marker([a.lat,a.long],s).addTo(ct);l.bindPopup('<span class="loader"></span>'),K.addLayer(l)});let o,i="#FF0000",r="#FFFFFF";switch(e.company){case"kmb":o=`kmb/${e.route}/${e.dir}_${e.routeType}`,i="#FF0000",r="#FFFFFF";break;case"ctb":o=`ctb/${e.route}/${e.dir}`,i="#F1CC02",r="#0080FF";break;case"nwfb":o=`nwfb/${e.route}/${e.dir}`,i="#EF7925",r="#7000CC";break;case"nlb":o=`nlb/${e.route}/${e.routeId}`,i="#2A897B",r="#3DC9B4";break;case"gmb":i="#337149",r="#53B776";break;case"mtr":o=`mtr/${e.route}/${e.dir}`,i="#1A81FF",r="#53B776";break}fetch(qo.replace("{path}",`${o}`)).then(a=>a.json()).then(a=>{let s=L.polyline.antPath(a,{color:i,pluseColor:r,...an});K.addLayer(s)}).catch(function(a){let s=e.stopList.map(c=>[c.lat,c.long]);s=[s];let l=L.polyline.antPath(s,{color:i,pluseColor:r,...an});K.addLayer(l)}),K.addTo(ct),ct.fitBounds(K.getBounds()),window.innerWidth<768&&Rn.hide()},ri=n=>{K.clearLayers();let t=n.target.closest("div.list-group-item");const e=JSON.parse(re(t.dataset.routeJson)),o=e.address.split(","),i={bookmarked:!0,company:e.company,route:e.route,routeId:e.routeId,routeType:e.serviceType,dir:e.dir,routeDesc:e.routeDesc,stop:e.stopId,name:e.name,address:e.address,street:e.street,fare:e.fare,fareHoliday:e.fareHoliday};var r=L.marker(o,i).addTo(ct);r.bindPopup('<span class="loader"></span>'),K.addLayer(r),K.addTo(ct),ct.fitBounds(K.getBounds()),r.openPopup(),window.innerWidth<768&&Rn.hide()},ai=async n=>fetch(Uo,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify([n])}).then(t=>t.json()).then(t=>t[0]).catch(t=>console.error(t)),si=async n=>{var t=n.popup._source;const e=await ai(t.options).then(r=>r.map(a=>{let s="<li>";return!isNaN(a.eta)&&a.eta>-1&&(s+=a.eta+"分鐘"),a.remark&&(s+="("+a.remark+")"),s+="</li>",s}).join("")).catch(()=>"<li>未有資料</li>");let o='<button class="btn btn-sm btn-outline-warning m-2"><i class="bi bi-bookmark-fill" aria-label="已收藏路線"></i></button>';if(!t.options.bookmarked){let r,a=document.querySelectorAll("div.list-group-item.group");a.length==0?(addGroup("預設群組"),r="預設群組"):r=a[0].dataset.groupName;const s={company:t.options.company,route:t.options.route,routeId:t.options.routeId,routeType:t.options.routeType,dir:t.options.dir,routeDesc:`${t.options.routeOrig}➡️${t.options.routeDest}`,stop:t.options.stop,name:t.options.name,address:`${t.options.lat},${t.options.long}`,street:t.options.street,fare:t.options.fare,fareHoliday:t.options.fareHoliday};(t.options.routeDesc=void 0)&&(t.options.routeDesc=s.routeDesc),o=`<button class="btn btn-sm btn-outline-warning m-2" onclick="addBookmark('${r}', '${$e(JSON.stringify(s))}', true)"><i id="bookmarkPopupIcon" class="bi bi-bookmark-plus" aria-label="收藏路線"></i></button>`}const i=`<b><img class="logo" src="${Me(t.options.company)}" alt="${t.options.company}"/> ${t.options.route} - ${t.options.name}</b>${o}<br/><small>${t.options.routeDesc}</small><br/><ul>${e}</ul>`;t._popup.setContent(i)};document.getElementById("btnSearch").onclick=oi;document.getElementById("routeInput").addEventListener("keypress",function(n){n.key==="Enter"&&(n.preventDefault(),document.getElementById("btnSearch").click())});var K=new L.FeatureGroup;const Fn=L.tileLayer(Qo,{maxZoom:20,attribution:xe}),li=L.tileLayer(Zo,{maxZoom:20,attribution:xe}),Hn=L.tileLayer(ti,{maxZoom:20,attribution:xe}),ci={地形圖:Fn,影像地圖:li},ui={地名標籤:Hn},ct=L.map("map",{center:[22.322005998683245,114.17846497109828],zoom:13,layers:[Fn,Hn]});L.control.layers(ci,ui,{hideSingleBase:!0}).addTo(ct);ct.on("popupopen",si);fetch(Jo).then(n=>n.json()).then(n=>{document.getElementById("getSiriShortcut").setAttribute("href",n.url),document.getElementById("siriShortcutVersion").innerHTML=`(v${n.version})`});window.renderRoute=ii;window.renderBookmarkStop=ri;const di="modal",fi="bs.modal",Y=`.${fi}`,hi=".data-api",pi="Escape",mi=`hide${Y}`,gi=`hidePrevented${Y}`,Yn=`hidden${Y}`,Wn=`show${Y}`,bi=`shown${Y}`,vi=`resize${Y}`,Ei=`click.dismiss${Y}`,_i=`mousedown.dismiss${Y}`,yi=`keydown.dismiss${Y}`,wi=`click${Y}${hi}`,sn="modal-open",Si="fade",ln="show",fe="modal-static",Di=".modal.show",Ai=".modal-dialog",ki=".modal-body",Ti='[data-bs-toggle="modal"]',Ci={backdrop:!0,focus:!0,keyboard:!0},Ni={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class bt extends Nn{constructor(t,e){super(t,e),this._dialog=P.findOne(Ai,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Ae,this._addEventListeners()}static get Default(){return Ci}static get DefaultType(){return Ni}static get NAME(){return di}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||this._isTransitioning||E.trigger(this._element,Wn,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(sn),this._adjustDialog(),this._backdrop.show(()=>this._showElement(t)))}hide(){!this._isShown||this._isTransitioning||E.trigger(this._element,mi).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(ln),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){E.off(window,Y),E.off(this._dialog,Y),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new In({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Ln({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const e=P.findOne(ki,this._dialog);e&&(e.scrollTop=0),En(this._element),this._element.classList.add(ln);const o=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,E.trigger(this._element,bi,{relatedTarget:t})};this._queueCallback(o,this._dialog,this._isAnimated())}_addEventListeners(){E.on(this._element,yi,t=>{if(t.key===pi){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),E.on(window,vi,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),E.on(this._element,_i,t=>{E.one(this._element,Ei,e=>{if(!(this._element!==t.target||this._element!==e.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(sn),this._resetAdjustments(),this._scrollBar.reset(),E.trigger(this._element,Yn)})}_isAnimated(){return this._element.classList.contains(Si)}_triggerBackdropTransition(){if(E.trigger(this._element,gi).defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,o=this._element.style.overflowY;o==="hidden"||this._element.classList.contains(fe)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(fe),this._queueCallback(()=>{this._element.classList.remove(fe),this._queueCallback(()=>{this._element.style.overflowY=o},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._scrollBar.getWidth(),o=e>0;if(o&&!t){const i=Ge()?"paddingLeft":"paddingRight";this._element.style[i]=`${e}px`}if(!o&&t){const i=Ge()?"paddingRight":"paddingLeft";this._element.style[i]=`${e}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,e){return this.each(function(){const o=bt.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof o[t]>"u")throw new TypeError(`No method named "${t}"`);o[t](e)}})}}E.on(document,wi,Ti,function(n){const t=P.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&n.preventDefault(),E.one(t,Wn,i=>{i.defaultPrevented||E.one(t,Yn,()=>{Ie(this)&&this.focus()})});const e=P.findOne(Di);e&&bt.getInstance(e).hide(),bt.getOrCreateInstance(t).toggle(this)});Bn(bt);yn(bt);/**!
 * Sortable 1.15.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function cn(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,o)}return e}function q(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?cn(Object(e),!0).forEach(function(o){Oi(n,o,e[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):cn(Object(e)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(e,o))})}return n}function Xt(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Xt=function(t){return typeof t}:Xt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xt(n)}function Oi(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function tt(){return tt=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},tt.apply(this,arguments)}function Ii(n,t){if(n==null)return{};var e={},o=Object.keys(n),i,r;for(r=0;r<o.length;r++)i=o[r],!(t.indexOf(i)>=0)&&(e[i]=n[i]);return e}function Bi(n,t){if(n==null)return{};var e=Ii(n,t),o,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)o=r[i],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(n,o)&&(e[o]=n[o])}return e}var Li="1.15.0";function Q(n){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(n)}var nt=Q(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ft=Q(/Edge/i),un=Q(/firefox/i),Pt=Q(/safari/i)&&!Q(/chrome/i)&&!Q(/android/i),Vn=Q(/iP(ad|od|hone)/i),jn=Q(/chrome/i)&&Q(/android/i),Gn={capture:!1,passive:!1};function w(n,t,e){n.addEventListener(t,e,!nt&&Gn)}function y(n,t,e){n.removeEventListener(t,e,!nt&&Gn)}function te(n,t){if(t){if(t[0]===">"&&(t=t.substring(1)),n)try{if(n.matches)return n.matches(t);if(n.msMatchesSelector)return n.msMatchesSelector(t);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(t)}catch{return!1}return!1}}function Pi(n){return n.host&&n!==document&&n.host.nodeType?n.host:n.parentNode}function z(n,t,e,o){if(n){e=e||document;do{if(t!=null&&(t[0]===">"?n.parentNode===e&&te(n,t):te(n,t))||o&&n===e)return n;if(n===e)break}while(n=Pi(n))}return null}var dn=/\s+/g;function x(n,t,e){if(n&&t)if(n.classList)n.classList[e?"add":"remove"](t);else{var o=(" "+n.className+" ").replace(dn," ").replace(" "+t+" "," ");n.className=(o+(e?" "+t:"")).replace(dn," ")}}function p(n,t,e){var o=n&&n.style;if(o){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(n,""):n.currentStyle&&(e=n.currentStyle),t===void 0?e:e[t];!(t in o)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),o[t]=e+(typeof e=="string"?"":"px")}}function St(n,t){var e="";if(typeof n=="string")e=n;else do{var o=p(n,"transform");o&&o!=="none"&&(e=o+" "+e)}while(!t&&(n=n.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(e)}function zn(n,t,e){if(n){var o=n.getElementsByTagName(t),i=0,r=o.length;if(e)for(;i<r;i++)e(o[i],i);return o}return[]}function X(){var n=document.scrollingElement;return n||document.documentElement}function T(n,t,e,o,i){if(!(!n.getBoundingClientRect&&n!==window)){var r,a,s,l,c,d,f;if(n!==window&&n.parentNode&&n!==X()?(r=n.getBoundingClientRect(),a=r.top,s=r.left,l=r.bottom,c=r.right,d=r.height,f=r.width):(a=0,s=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,f=window.innerWidth),(t||e)&&n!==window&&(i=i||n.parentNode,!nt))do if(i&&i.getBoundingClientRect&&(p(i,"transform")!=="none"||e&&p(i,"position")!=="static")){var m=i.getBoundingClientRect();a-=m.top+parseInt(p(i,"border-top-width")),s-=m.left+parseInt(p(i,"border-left-width")),l=a+r.height,c=s+r.width;break}while(i=i.parentNode);if(o&&n!==window){var _=St(i||n),v=_&&_.a,b=_&&_.d;_&&(a/=b,s/=v,f/=v,d/=b,l=a+d,c=s+f)}return{top:a,left:s,bottom:l,right:c,width:f,height:d}}}function fn(n,t,e){for(var o=lt(n,!0),i=T(n)[t];o;){var r=T(o)[e],a=void 0;if(e==="top"||e==="left"?a=i>=r:a=i<=r,!a)return o;if(o===X())break;o=lt(o,!1)}return!1}function Dt(n,t,e,o){for(var i=0,r=0,a=n.children;r<a.length;){if(a[r].style.display!=="none"&&a[r]!==h.ghost&&(o||a[r]!==h.dragged)&&z(a[r],e.draggable,n,!1)){if(i===t)return a[r];i++}r++}return null}function Re(n,t){for(var e=n.lastElementChild;e&&(e===h.ghost||p(e,"display")==="none"||t&&!te(e,t));)e=e.previousElementSibling;return e||null}function H(n,t){var e=0;if(!n||!n.parentNode)return-1;for(;n=n.previousElementSibling;)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==h.clone&&(!t||te(n,t))&&e++;return e}function hn(n){var t=0,e=0,o=X();if(n)do{var i=St(n),r=i.a,a=i.d;t+=n.scrollLeft*r,e+=n.scrollTop*a}while(n!==o&&(n=n.parentNode));return[t,e]}function $i(n,t){for(var e in n)if(n.hasOwnProperty(e)){for(var o in t)if(t.hasOwnProperty(o)&&t[o]===n[e][o])return Number(e)}return-1}function lt(n,t){if(!n||!n.getBoundingClientRect)return X();var e=n,o=!1;do if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){var i=p(e);if(e.clientWidth<e.scrollWidth&&(i.overflowX=="auto"||i.overflowX=="scroll")||e.clientHeight<e.scrollHeight&&(i.overflowY=="auto"||i.overflowY=="scroll")){if(!e.getBoundingClientRect||e===document.body)return X();if(o||t)return e;o=!0}}while(e=e.parentNode);return X()}function Mi(n,t){if(n&&t)for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function he(n,t){return Math.round(n.top)===Math.round(t.top)&&Math.round(n.left)===Math.round(t.left)&&Math.round(n.height)===Math.round(t.height)&&Math.round(n.width)===Math.round(t.width)}var $t;function Kn(n,t){return function(){if(!$t){var e=arguments,o=this;e.length===1?n.call(o,e[0]):n.apply(o,e),$t=setTimeout(function(){$t=void 0},t)}}}function xi(){clearTimeout($t),$t=void 0}function Xn(n,t,e){n.scrollLeft+=t,n.scrollTop+=e}function qn(n){var t=window.Polymer,e=window.jQuery||window.Zepto;return t&&t.dom?t.dom(n).cloneNode(!0):e?e(n).clone(!0)[0]:n.cloneNode(!0)}var F="Sortable"+new Date().getTime();function Ri(){var n=[],t;return{captureAnimationState:function(){if(n=[],!!this.options.animation){var o=[].slice.call(this.el.children);o.forEach(function(i){if(!(p(i,"display")==="none"||i===h.ghost)){n.push({target:i,rect:T(i)});var r=q({},n[n.length-1].rect);if(i.thisAnimationDuration){var a=St(i,!0);a&&(r.top-=a.f,r.left-=a.e)}i.fromRect=r}})}},addAnimationState:function(o){n.push(o)},removeAnimationState:function(o){n.splice($i(n,{target:o}),1)},animateAll:function(o){var i=this;if(!this.options.animation){clearTimeout(t),typeof o=="function"&&o();return}var r=!1,a=0;n.forEach(function(s){var l=0,c=s.target,d=c.fromRect,f=T(c),m=c.prevFromRect,_=c.prevToRect,v=s.rect,b=St(c,!0);b&&(f.top-=b.f,f.left-=b.e),c.toRect=f,c.thisAnimationDuration&&he(m,f)&&!he(d,f)&&(v.top-f.top)/(v.left-f.left)===(d.top-f.top)/(d.left-f.left)&&(l=Hi(v,m,_,i.options)),he(f,d)||(c.prevFromRect=d,c.prevToRect=f,l||(l=i.options.animation),i.animate(c,v,f,l)),l&&(r=!0,a=Math.max(a,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(t),r?t=setTimeout(function(){typeof o=="function"&&o()},a):typeof o=="function"&&o(),n=[]},animate:function(o,i,r,a){if(a){p(o,"transition",""),p(o,"transform","");var s=St(this.el),l=s&&s.a,c=s&&s.d,d=(i.left-r.left)/(l||1),f=(i.top-r.top)/(c||1);o.animatingX=!!d,o.animatingY=!!f,p(o,"transform","translate3d("+d+"px,"+f+"px,0)"),this.forRepaintDummy=Fi(o),p(o,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),p(o,"transform","translate3d(0,0,0)"),typeof o.animated=="number"&&clearTimeout(o.animated),o.animated=setTimeout(function(){p(o,"transition",""),p(o,"transform",""),o.animated=!1,o.animatingX=!1,o.animatingY=!1},a)}}}}function Fi(n){return n.offsetWidth}function Hi(n,t,e,o){return Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))/Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))*o.animation}var vt=[],pe={initializeByDefault:!0},Ht={mount:function(t){for(var e in pe)pe.hasOwnProperty(e)&&!(e in t)&&(t[e]=pe[e]);vt.forEach(function(o){if(o.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),vt.push(t)},pluginEvent:function(t,e,o){var i=this;this.eventCanceled=!1,o.cancel=function(){i.eventCanceled=!0};var r=t+"Global";vt.forEach(function(a){e[a.pluginName]&&(e[a.pluginName][r]&&e[a.pluginName][r](q({sortable:e},o)),e.options[a.pluginName]&&e[a.pluginName][t]&&e[a.pluginName][t](q({sortable:e},o)))})},initializePlugins:function(t,e,o,i){vt.forEach(function(s){var l=s.pluginName;if(!(!t.options[l]&&!s.initializeByDefault)){var c=new s(t,e,t.options);c.sortable=t,c.options=t.options,t[l]=c,tt(o,c.defaults)}});for(var r in t.options)if(t.options.hasOwnProperty(r)){var a=this.modifyOption(t,r,t.options[r]);typeof a<"u"&&(t.options[r]=a)}},getEventProperties:function(t,e){var o={};return vt.forEach(function(i){typeof i.eventProperties=="function"&&tt(o,i.eventProperties.call(e[i.pluginName],t))}),o},modifyOption:function(t,e,o){var i;return vt.forEach(function(r){t[r.pluginName]&&r.optionListeners&&typeof r.optionListeners[e]=="function"&&(i=r.optionListeners[e].call(t[r.pluginName],o))}),i}};function Yi(n){var t=n.sortable,e=n.rootEl,o=n.name,i=n.targetEl,r=n.cloneEl,a=n.toEl,s=n.fromEl,l=n.oldIndex,c=n.newIndex,d=n.oldDraggableIndex,f=n.newDraggableIndex,m=n.originalEvent,_=n.putSortable,v=n.extraEventProperties;if(t=t||e&&e[F],!!t){var b,W=t.options,U="on"+o.charAt(0).toUpperCase()+o.substr(1);window.CustomEvent&&!nt&&!Ft?b=new CustomEvent(o,{bubbles:!0,cancelable:!0}):(b=document.createEvent("Event"),b.initEvent(o,!0,!0)),b.to=a||e,b.from=s||e,b.item=i||e,b.clone=r,b.oldIndex=l,b.newIndex=c,b.oldDraggableIndex=d,b.newDraggableIndex=f,b.originalEvent=m,b.pullMode=_?_.lastPutMode:void 0;var O=q(q({},v),Ht.getEventProperties(o,t));for(var V in O)b[V]=O[V];e&&e.dispatchEvent(b),W[U]&&W[U].call(t,b)}}var Wi=["evt"],B=function(t,e){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=o.evt,r=Bi(o,Wi);Ht.pluginEvent.bind(h)(t,e,q({dragEl:u,parentEl:A,ghostEl:g,rootEl:S,nextEl:mt,lastDownEl:qt,cloneEl:D,cloneHidden:st,dragStarted:Ot,putSortable:C,activeSortable:h.active,originalEvent:i,oldIndex:yt,oldDraggableIndex:Mt,newIndex:R,newDraggableIndex:at,hideGhostForTarget:Zn,unhideGhostForTarget:to,cloneNowHidden:function(){st=!0},cloneNowShown:function(){st=!1},dispatchSortableEvent:function(s){I({sortable:e,name:s,originalEvent:i})}},r))};function I(n){Yi(q({putSortable:C,cloneEl:D,targetEl:u,rootEl:S,oldIndex:yt,oldDraggableIndex:Mt,newIndex:R,newDraggableIndex:at},n))}var u,A,g,S,mt,qt,D,st,yt,R,Mt,at,jt,C,_t=!1,ee=!1,ne=[],ht,j,me,ge,pn,mn,Ot,Et,xt,Rt=!1,Gt=!1,Ut,N,be=[],Te=!1,oe=[],ae=typeof document<"u",zt=Vn,gn=Ft||nt?"cssFloat":"float",Vi=ae&&!jn&&!Vn&&"draggable"in document.createElement("div"),Un=function(){if(ae){if(nt)return!1;var n=document.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}}(),Jn=function(t,e){var o=p(t),i=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),r=Dt(t,0,e),a=Dt(t,1,e),s=r&&p(r),l=a&&p(a),c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+T(r).width,d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+T(a).width;if(o.display==="flex")return o.flexDirection==="column"||o.flexDirection==="column-reverse"?"vertical":"horizontal";if(o.display==="grid")return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(r&&s.float&&s.float!=="none"){var f=s.float==="left"?"left":"right";return a&&(l.clear==="both"||l.clear===f)?"vertical":"horizontal"}return r&&(s.display==="block"||s.display==="flex"||s.display==="table"||s.display==="grid"||c>=i&&o[gn]==="none"||a&&o[gn]==="none"&&c+d>i)?"vertical":"horizontal"},ji=function(t,e,o){var i=o?t.left:t.top,r=o?t.right:t.bottom,a=o?t.width:t.height,s=o?e.left:e.top,l=o?e.right:e.bottom,c=o?e.width:e.height;return i===s||r===l||i+a/2===s+c/2},Gi=function(t,e){var o;return ne.some(function(i){var r=i[F].options.emptyInsertThreshold;if(!(!r||Re(i))){var a=T(i),s=t>=a.left-r&&t<=a.right+r,l=e>=a.top-r&&e<=a.bottom+r;if(s&&l)return o=i}}),o},Qn=function(t){function e(r,a){return function(s,l,c,d){var f=s.options.group.name&&l.options.group.name&&s.options.group.name===l.options.group.name;if(r==null&&(a||f))return!0;if(r==null||r===!1)return!1;if(a&&r==="clone")return r;if(typeof r=="function")return e(r(s,l,c,d),a)(s,l,c,d);var m=(a?s:l).options.group.name;return r===!0||typeof r=="string"&&r===m||r.join&&r.indexOf(m)>-1}}var o={},i=t.group;(!i||Xt(i)!="object")&&(i={name:i}),o.name=i.name,o.checkPull=e(i.pull,!0),o.checkPut=e(i.put),o.revertClone=i.revertClone,t.group=o},Zn=function(){!Un&&g&&p(g,"display","none")},to=function(){!Un&&g&&p(g,"display","")};ae&&!jn&&document.addEventListener("click",function(n){if(ee)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),ee=!1,!1},!0);var pt=function(t){if(u){t=t.touches?t.touches[0]:t;var e=Gi(t.clientX,t.clientY);if(e){var o={};for(var i in t)t.hasOwnProperty(i)&&(o[i]=t[i]);o.target=o.rootEl=e,o.preventDefault=void 0,o.stopPropagation=void 0,e[F]._onDragOver(o)}}},zi=function(t){u&&u.parentNode[F]._isOutsideThisEl(t.target)};function h(n,t){if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(n));this.el=n,this.options=t=tt({},t),n[F]=this;var e={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Jn(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(a,s){a.setData("Text",s.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:h.supportPointer!==!1&&"PointerEvent"in window&&!Pt,emptyInsertThreshold:5};Ht.initializePlugins(this,n,e);for(var o in e)!(o in t)&&(t[o]=e[o]);Qn(t);for(var i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this));this.nativeDraggable=t.forceFallback?!1:Vi,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?w(n,"pointerdown",this._onTapStart):(w(n,"mousedown",this._onTapStart),w(n,"touchstart",this._onTapStart)),this.nativeDraggable&&(w(n,"dragover",this),w(n,"dragenter",this)),ne.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),tt(this,Ri())}h.prototype={constructor:h,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(Et=null)},_getDirection:function(t,e){return typeof this.options.direction=="function"?this.options.direction.call(this,t,e,u):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,o=this.el,i=this.options,r=i.preventOnFilter,a=t.type,s=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(s||t).target,c=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,d=i.filter;if(tr(o),!u&&!(/mousedown|pointerdown/.test(a)&&t.button!==0||i.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Pt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=z(l,i.draggable,o,!1),!(l&&l.animated)&&qt!==l)){if(yt=H(l),Mt=H(l,i.draggable),typeof d=="function"){if(d.call(this,t,l,this)){I({sortable:e,rootEl:c,name:"filter",targetEl:l,toEl:o,fromEl:o}),B("filter",e,{evt:t}),r&&t.cancelable&&t.preventDefault();return}}else if(d&&(d=d.split(",").some(function(f){if(f=z(c,f.trim(),o,!1),f)return I({sortable:e,rootEl:f,name:"filter",targetEl:l,fromEl:o,toEl:o}),B("filter",e,{evt:t}),!0}),d)){r&&t.cancelable&&t.preventDefault();return}i.handle&&!z(c,i.handle,o,!1)||this._prepareDragStart(t,s,l)}}},_prepareDragStart:function(t,e,o){var i=this,r=i.el,a=i.options,s=r.ownerDocument,l;if(o&&!u&&o.parentNode===r){var c=T(o);if(S=r,u=o,A=u.parentNode,mt=u.nextSibling,qt=o,jt=a.group,h.dragged=u,ht={target:u,clientX:(e||t).clientX,clientY:(e||t).clientY},pn=ht.clientX-c.left,mn=ht.clientY-c.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,u.style["will-change"]="all",l=function(){if(B("delayEnded",i,{evt:t}),h.eventCanceled){i._onDrop();return}i._disableDelayedDragEvents(),!un&&i.nativeDraggable&&(u.draggable=!0),i._triggerDragStart(t,e),I({sortable:i,name:"choose",originalEvent:t}),x(u,a.chosenClass,!0)},a.ignore.split(",").forEach(function(d){zn(u,d.trim(),ve)}),w(s,"dragover",pt),w(s,"mousemove",pt),w(s,"touchmove",pt),w(s,"mouseup",i._onDrop),w(s,"touchend",i._onDrop),w(s,"touchcancel",i._onDrop),un&&this.nativeDraggable&&(this.options.touchStartThreshold=4,u.draggable=!0),B("delayStart",this,{evt:t}),a.delay&&(!a.delayOnTouchOnly||e)&&(!this.nativeDraggable||!(Ft||nt))){if(h.eventCanceled){this._onDrop();return}w(s,"mouseup",i._disableDelayedDrag),w(s,"touchend",i._disableDelayedDrag),w(s,"touchcancel",i._disableDelayedDrag),w(s,"mousemove",i._delayedDragTouchMoveHandler),w(s,"touchmove",i._delayedDragTouchMoveHandler),a.supportPointer&&w(s,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(l,a.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){u&&ve(u),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;y(t,"mouseup",this._disableDelayedDrag),y(t,"touchend",this._disableDelayedDrag),y(t,"touchcancel",this._disableDelayedDrag),y(t,"mousemove",this._delayedDragTouchMoveHandler),y(t,"touchmove",this._delayedDragTouchMoveHandler),y(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||t.pointerType=="touch"&&t,!this.nativeDraggable||e?this.options.supportPointer?w(document,"pointermove",this._onTouchMove):e?w(document,"touchmove",this._onTouchMove):w(document,"mousemove",this._onTouchMove):(w(u,"dragend",this),w(S,"dragstart",this._onDragStart));try{document.selection?Jt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,e){if(_t=!1,S&&u){B("dragStarted",this,{evt:e}),this.nativeDraggable&&w(document,"dragover",zi);var o=this.options;!t&&x(u,o.dragClass,!1),x(u,o.ghostClass,!0),h.active=this,t&&this._appendGhost(),I({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(j){this._lastX=j.clientX,this._lastY=j.clientY,Zn();for(var t=document.elementFromPoint(j.clientX,j.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(j.clientX,j.clientY),t!==e);)e=t;if(u.parentNode[F]._isOutsideThisEl(t),e)do{if(e[F]){var o=void 0;if(o=e[F]._onDragOver({clientX:j.clientX,clientY:j.clientY,target:t,rootEl:e}),o&&!this.options.dragoverBubble)break}t=e}while(e=e.parentNode);to()}},_onTouchMove:function(t){if(ht){var e=this.options,o=e.fallbackTolerance,i=e.fallbackOffset,r=t.touches?t.touches[0]:t,a=g&&St(g,!0),s=g&&a&&a.a,l=g&&a&&a.d,c=zt&&N&&hn(N),d=(r.clientX-ht.clientX+i.x)/(s||1)+(c?c[0]-be[0]:0)/(s||1),f=(r.clientY-ht.clientY+i.y)/(l||1)+(c?c[1]-be[1]:0)/(l||1);if(!h.active&&!_t){if(o&&Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))<o)return;this._onDragStart(t,!0)}if(g){a?(a.e+=d-(me||0),a.f+=f-(ge||0)):a={a:1,b:0,c:0,d:1,e:d,f};var m="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")");p(g,"webkitTransform",m),p(g,"mozTransform",m),p(g,"msTransform",m),p(g,"transform",m),me=d,ge=f,j=r}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!g){var t=this.options.fallbackOnBody?document.body:S,e=T(u,!0,zt,!0,t),o=this.options;if(zt){for(N=t;p(N,"position")==="static"&&p(N,"transform")==="none"&&N!==document;)N=N.parentNode;N!==document.body&&N!==document.documentElement?(N===document&&(N=X()),e.top+=N.scrollTop,e.left+=N.scrollLeft):N=X(),be=hn(N)}g=u.cloneNode(!0),x(g,o.ghostClass,!1),x(g,o.fallbackClass,!0),x(g,o.dragClass,!0),p(g,"transition",""),p(g,"transform",""),p(g,"box-sizing","border-box"),p(g,"margin",0),p(g,"top",e.top),p(g,"left",e.left),p(g,"width",e.width),p(g,"height",e.height),p(g,"opacity","0.8"),p(g,"position",zt?"absolute":"fixed"),p(g,"zIndex","100000"),p(g,"pointerEvents","none"),h.ghost=g,t.appendChild(g),p(g,"transform-origin",pn/parseInt(g.style.width)*100+"% "+mn/parseInt(g.style.height)*100+"%")}},_onDragStart:function(t,e){var o=this,i=t.dataTransfer,r=o.options;if(B("dragStart",this,{evt:t}),h.eventCanceled){this._onDrop();return}B("setupClone",this),h.eventCanceled||(D=qn(u),D.removeAttribute("id"),D.draggable=!1,D.style["will-change"]="",this._hideClone(),x(D,this.options.chosenClass,!1),h.clone=D),o.cloneId=Jt(function(){B("clone",o),!h.eventCanceled&&(o.options.removeCloneOnHide||S.insertBefore(D,u),o._hideClone(),I({sortable:o,name:"clone"}))}),!e&&x(u,r.dragClass,!0),e?(ee=!0,o._loopId=setInterval(o._emulateDragOver,50)):(y(document,"mouseup",o._onDrop),y(document,"touchend",o._onDrop),y(document,"touchcancel",o._onDrop),i&&(i.effectAllowed="move",r.setData&&r.setData.call(o,i,u)),w(document,"drop",o),p(u,"transform","translateZ(0)")),_t=!0,o._dragStartId=Jt(o._dragStarted.bind(o,e,t)),w(document,"selectstart",o),Ot=!0,Pt&&p(document.body,"user-select","none")},_onDragOver:function(t){var e=this.el,o=t.target,i,r,a,s=this.options,l=s.group,c=h.active,d=jt===l,f=s.sort,m=C||c,_,v=this,b=!1;if(Te)return;function W(Nt,so){B(Nt,v,q({evt:t,isOwner:d,axis:_?"vertical":"horizontal",revert:a,dragRect:i,targetRect:r,canSort:f,fromSortable:m,target:o,completed:O,onMove:function(je,lo){return Kt(S,e,u,i,je,T(je),t,lo)},changed:V},so))}function U(){W("dragOverAnimationCapture"),v.captureAnimationState(),v!==m&&m.captureAnimationState()}function O(Nt){return W("dragOverCompleted",{insertion:Nt}),Nt&&(d?c._hideClone():c._showClone(v),v!==m&&(x(u,C?C.options.ghostClass:c.options.ghostClass,!1),x(u,s.ghostClass,!0)),C!==v&&v!==h.active?C=v:v===h.active&&C&&(C=null),m===v&&(v._ignoreWhileAnimating=o),v.animateAll(function(){W("dragOverAnimationComplete"),v._ignoreWhileAnimating=null}),v!==m&&(m.animateAll(),m._ignoreWhileAnimating=null)),(o===u&&!u.animated||o===e&&!o.animated)&&(Et=null),!s.dragoverBubble&&!t.rootEl&&o!==document&&(u.parentNode[F]._isOutsideThisEl(t.target),!Nt&&pt(t)),!s.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),b=!0}function V(){R=H(u),at=H(u,s.draggable),I({sortable:v,name:"change",toEl:e,newIndex:R,newDraggableIndex:at,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),o=z(o,s.draggable,e,!0),W("dragOver"),h.eventCanceled)return b;if(u.contains(t.target)||o.animated&&o.animatingX&&o.animatingY||v._ignoreWhileAnimating===o)return O(!1);if(ee=!1,c&&!s.disabled&&(d?f||(a=A!==S):C===this||(this.lastPutMode=jt.checkPull(this,c,u,t))&&l.checkPut(this,c,u,t))){if(_=this._getDirection(t,o)==="vertical",i=T(u),W("dragOverValid"),h.eventCanceled)return b;if(a)return A=S,U(),this._hideClone(),W("revert"),h.eventCanceled||(mt?S.insertBefore(u,mt):S.appendChild(u)),O(!0);var $=Re(e,s.draggable);if(!$||Ui(t,_,this)&&!$.animated){if($===u)return O(!1);if($&&e===t.target&&(o=$),o&&(r=T(o)),Kt(S,e,u,i,o,r,t,!!o)!==!1)return U(),$&&$.nextSibling?e.insertBefore(u,$.nextSibling):e.appendChild(u),A=e,V(),O(!0)}else if($&&qi(t,_,this)){var ut=Dt(e,0,s,!0);if(ut===u)return O(!1);if(o=ut,r=T(o),Kt(S,e,u,i,o,r,t,!1)!==!1)return U(),e.insertBefore(u,ut),A=e,V(),O(!0)}else if(o.parentNode===e){r=T(o);var G=0,dt,At=u.parentNode!==e,M=!ji(u.animated&&u.toRect||i,o.animated&&o.toRect||r,_),kt=_?"top":"left",ot=fn(o,"top","top")||fn(u,"top","top"),Tt=ot?ot.scrollTop:void 0;Et!==o&&(dt=r[kt],Rt=!1,Gt=!M&&s.invertSwap||At),G=Ji(t,o,r,_,M?1:s.swapThreshold,s.invertedSwapThreshold==null?s.swapThreshold:s.invertedSwapThreshold,Gt,Et===o);var J;if(G!==0){var ft=H(u);do ft-=G,J=A.children[ft];while(J&&(p(J,"display")==="none"||J===g))}if(G===0||J===o)return O(!1);Et=o,xt=G;var Ct=o.nextElementSibling,it=!1;it=G===1;var Yt=Kt(S,e,u,i,o,r,t,it);if(Yt!==!1)return(Yt===1||Yt===-1)&&(it=Yt===1),Te=!0,setTimeout(Xi,30),U(),it&&!Ct?e.appendChild(u):o.parentNode.insertBefore(u,it?Ct:o),ot&&Xn(ot,0,Tt-ot.scrollTop),A=u.parentNode,dt!==void 0&&!Gt&&(Ut=Math.abs(dt-T(o)[kt])),V(),O(!0)}if(e.contains(u))return O(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){y(document,"mousemove",this._onTouchMove),y(document,"touchmove",this._onTouchMove),y(document,"pointermove",this._onTouchMove),y(document,"dragover",pt),y(document,"mousemove",pt),y(document,"touchmove",pt)},_offUpEvents:function(){var t=this.el.ownerDocument;y(t,"mouseup",this._onDrop),y(t,"touchend",this._onDrop),y(t,"pointerup",this._onDrop),y(t,"touchcancel",this._onDrop),y(document,"selectstart",this)},_onDrop:function(t){var e=this.el,o=this.options;if(R=H(u),at=H(u,o.draggable),B("drop",this,{evt:t}),A=u&&u.parentNode,R=H(u),at=H(u,o.draggable),h.eventCanceled){this._nulling();return}_t=!1,Gt=!1,Rt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ce(this.cloneId),Ce(this._dragStartId),this.nativeDraggable&&(y(document,"drop",this),y(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Pt&&p(document.body,"user-select",""),p(u,"transform",""),t&&(Ot&&(t.cancelable&&t.preventDefault(),!o.dropBubble&&t.stopPropagation()),g&&g.parentNode&&g.parentNode.removeChild(g),(S===A||C&&C.lastPutMode!=="clone")&&D&&D.parentNode&&D.parentNode.removeChild(D),u&&(this.nativeDraggable&&y(u,"dragend",this),ve(u),u.style["will-change"]="",Ot&&!_t&&x(u,C?C.options.ghostClass:this.options.ghostClass,!1),x(u,this.options.chosenClass,!1),I({sortable:this,name:"unchoose",toEl:A,newIndex:null,newDraggableIndex:null,originalEvent:t}),S!==A?(R>=0&&(I({rootEl:A,name:"add",toEl:A,fromEl:S,originalEvent:t}),I({sortable:this,name:"remove",toEl:A,originalEvent:t}),I({rootEl:A,name:"sort",toEl:A,fromEl:S,originalEvent:t}),I({sortable:this,name:"sort",toEl:A,originalEvent:t})),C&&C.save()):R!==yt&&R>=0&&(I({sortable:this,name:"update",toEl:A,originalEvent:t}),I({sortable:this,name:"sort",toEl:A,originalEvent:t})),h.active&&((R==null||R===-1)&&(R=yt,at=Mt),I({sortable:this,name:"end",toEl:A,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){B("nulling",this),S=u=A=g=mt=D=qt=st=ht=j=Ot=R=at=yt=Mt=Et=xt=C=jt=h.dragged=h.ghost=h.clone=h.active=null,oe.forEach(function(t){t.checked=!0}),oe.length=me=ge=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":u&&(this._onDragOver(t),Ki(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],e,o=this.el.children,i=0,r=o.length,a=this.options;i<r;i++)e=o[i],z(e,a.draggable,this.el,!1)&&t.push(e.getAttribute(a.dataIdAttr)||Zi(e));return t},sort:function(t,e){var o={},i=this.el;this.toArray().forEach(function(r,a){var s=i.children[a];z(s,this.options.draggable,i,!1)&&(o[r]=s)},this),e&&this.captureAnimationState(),t.forEach(function(r){o[r]&&(i.removeChild(o[r]),i.appendChild(o[r]))}),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return z(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var o=this.options;if(e===void 0)return o[t];var i=Ht.modifyOption(this,t,e);typeof i<"u"?o[t]=i:o[t]=e,t==="group"&&Qn(o)},destroy:function(){B("destroy",this);var t=this.el;t[F]=null,y(t,"mousedown",this._onTapStart),y(t,"touchstart",this._onTapStart),y(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(y(t,"dragover",this),y(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ne.splice(ne.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!st){if(B("hideClone",this),h.eventCanceled)return;p(D,"display","none"),this.options.removeCloneOnHide&&D.parentNode&&D.parentNode.removeChild(D),st=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(st){if(B("showClone",this),h.eventCanceled)return;u.parentNode==S&&!this.options.group.revertClone?S.insertBefore(D,u):mt?S.insertBefore(D,mt):S.appendChild(D),this.options.group.revertClone&&this.animate(u,D),p(D,"display",""),st=!1}}};function Ki(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.cancelable&&n.preventDefault()}function Kt(n,t,e,o,i,r,a,s){var l,c=n[F],d=c.options.onMove,f;return window.CustomEvent&&!nt&&!Ft?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=n,l.dragged=e,l.draggedRect=o,l.related=i||t,l.relatedRect=r||T(t),l.willInsertAfter=s,l.originalEvent=a,n.dispatchEvent(l),d&&(f=d.call(c,l,a)),f}function ve(n){n.draggable=!1}function Xi(){Te=!1}function qi(n,t,e){var o=T(Dt(e.el,0,e.options,!0)),i=10;return t?n.clientX<o.left-i||n.clientY<o.top&&n.clientX<o.right:n.clientY<o.top-i||n.clientY<o.bottom&&n.clientX<o.left}function Ui(n,t,e){var o=T(Re(e.el,e.options.draggable)),i=10;return t?n.clientX>o.right+i||n.clientX<=o.right&&n.clientY>o.bottom&&n.clientX>=o.left:n.clientX>o.right&&n.clientY>o.top||n.clientX<=o.right&&n.clientY>o.bottom+i}function Ji(n,t,e,o,i,r,a,s){var l=o?n.clientY:n.clientX,c=o?e.height:e.width,d=o?e.top:e.left,f=o?e.bottom:e.right,m=!1;if(!a){if(s&&Ut<c*i){if(!Rt&&(xt===1?l>d+c*r/2:l<f-c*r/2)&&(Rt=!0),Rt)m=!0;else if(xt===1?l<d+Ut:l>f-Ut)return-xt}else if(l>d+c*(1-i)/2&&l<f-c*(1-i)/2)return Qi(t)}return m=m||a,m&&(l<d+c*r/2||l>f-c*r/2)?l>d+c/2?1:-1:0}function Qi(n){return H(u)<H(n)?1:-1}function Zi(n){for(var t=n.tagName+n.className+n.src+n.href+n.textContent,e=t.length,o=0;e--;)o+=t.charCodeAt(e);return o.toString(36)}function tr(n){oe.length=0;for(var t=n.getElementsByTagName("input"),e=t.length;e--;){var o=t[e];o.checked&&oe.push(o)}}function Jt(n){return setTimeout(n,0)}function Ce(n){return clearTimeout(n)}ae&&w(document,"touchmove",function(n){(h.active||_t)&&n.cancelable&&n.preventDefault()});h.utils={on:w,off:y,css:p,find:zn,is:function(t,e){return!!z(t,e,t,!1)},extend:Mi,throttle:Kn,closest:z,toggleClass:x,clone:qn,index:H,nextTick:Jt,cancelNextTick:Ce,detectDirection:Jn,getChild:Dt};h.get=function(n){return n[F]};h.mount=function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];t[0].constructor===Array&&(t=t[0]),t.forEach(function(o){if(!o.prototype||!o.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(o));o.utils&&(h.utils=q(q({},h.utils),o.utils)),Ht.mount(o)})};h.create=function(n,t){return new h(n,t)};h.version=Li;var k=[],It,Ne,Oe=!1,Ee,_e,ie,Bt;function er(){function n(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return n.prototype={dragStarted:function(e){var o=e.originalEvent;this.sortable.nativeDraggable?w(document,"dragover",this._handleAutoScroll):this.options.supportPointer?w(document,"pointermove",this._handleFallbackAutoScroll):o.touches?w(document,"touchmove",this._handleFallbackAutoScroll):w(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var o=e.originalEvent;!this.options.dragOverBubble&&!o.rootEl&&this._handleAutoScroll(o)},drop:function(){this.sortable.nativeDraggable?y(document,"dragover",this._handleAutoScroll):(y(document,"pointermove",this._handleFallbackAutoScroll),y(document,"touchmove",this._handleFallbackAutoScroll),y(document,"mousemove",this._handleFallbackAutoScroll)),bn(),Qt(),xi()},nulling:function(){ie=Ne=It=Oe=Bt=Ee=_e=null,k.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,o){var i=this,r=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,s=document.elementFromPoint(r,a);if(ie=e,o||this.options.forceAutoScrollFallback||Ft||nt||Pt){ye(e,this.options,s,o);var l=lt(s,!0);Oe&&(!Bt||r!==Ee||a!==_e)&&(Bt&&bn(),Bt=setInterval(function(){var c=lt(document.elementFromPoint(r,a),!0);c!==l&&(l=c,Qt()),ye(e,i.options,c,o)},10),Ee=r,_e=a)}else{if(!this.options.bubbleScroll||lt(s,!0)===X()){Qt();return}ye(e,this.options,lt(s,!1),!1)}}},tt(n,{pluginName:"scroll",initializeByDefault:!0})}function Qt(){k.forEach(function(n){clearInterval(n.pid)}),k=[]}function bn(){clearInterval(Bt)}var ye=Kn(function(n,t,e,o){if(t.scroll){var i=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,a=t.scrollSensitivity,s=t.scrollSpeed,l=X(),c=!1,d;Ne!==e&&(Ne=e,Qt(),It=t.scroll,d=t.scrollFn,It===!0&&(It=lt(e,!0)));var f=0,m=It;do{var _=m,v=T(_),b=v.top,W=v.bottom,U=v.left,O=v.right,V=v.width,$=v.height,ut=void 0,G=void 0,dt=_.scrollWidth,At=_.scrollHeight,M=p(_),kt=_.scrollLeft,ot=_.scrollTop;_===l?(ut=V<dt&&(M.overflowX==="auto"||M.overflowX==="scroll"||M.overflowX==="visible"),G=$<At&&(M.overflowY==="auto"||M.overflowY==="scroll"||M.overflowY==="visible")):(ut=V<dt&&(M.overflowX==="auto"||M.overflowX==="scroll"),G=$<At&&(M.overflowY==="auto"||M.overflowY==="scroll"));var Tt=ut&&(Math.abs(O-i)<=a&&kt+V<dt)-(Math.abs(U-i)<=a&&!!kt),J=G&&(Math.abs(W-r)<=a&&ot+$<At)-(Math.abs(b-r)<=a&&!!ot);if(!k[f])for(var ft=0;ft<=f;ft++)k[ft]||(k[ft]={});(k[f].vx!=Tt||k[f].vy!=J||k[f].el!==_)&&(k[f].el=_,k[f].vx=Tt,k[f].vy=J,clearInterval(k[f].pid),(Tt!=0||J!=0)&&(c=!0,k[f].pid=setInterval((function(){o&&this.layer===0&&h.active._onTouchMove(ie);var Ct=k[this.layer].vy?k[this.layer].vy*s:0,it=k[this.layer].vx?k[this.layer].vx*s:0;typeof d=="function"&&d.call(h.dragged.parentNode[F],it,Ct,n,ie,k[this.layer].el)!=="continue"||Xn(k[this.layer].el,it,Ct)}).bind({layer:f}),24))),f++}while(t.bubbleScroll&&m!==l&&(m=lt(m,!1)));Oe=c}},30),eo=function(t){var e=t.originalEvent,o=t.putSortable,i=t.dragEl,r=t.activeSortable,a=t.dispatchSortableEvent,s=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(e){var c=o||r;s();var d=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,f=document.elementFromPoint(d.clientX,d.clientY);l(),c&&!c.el.contains(f)&&(a("spill"),this.onSpill({dragEl:i,putSortable:o}))}};function Fe(){}Fe.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,o=t.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var i=Dt(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(e,i):this.sortable.el.appendChild(e),this.sortable.animateAll(),o&&o.animateAll()},drop:eo};tt(Fe,{pluginName:"revertOnSpill"});function He(){}He.prototype={onSpill:function(t){var e=t.dragEl,o=t.putSortable,i=o||this.sortable;i.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),i.animateAll()},drop:eo};tt(He,{pluginName:"removeOnSpill"});h.mount(new er);h.mount(He,Fe);const no=document.getElementById("bookmarkList"),oo="##",io=`
`,nr=new bt("#addGroupModal"),Ye=n=>{n?([document.getElementById("btnBookmarkEdit"),document.getElementById("btnBookmarkDownload"),document.getElementById("btnBookmarkUpload")].forEach((t,e,o)=>{t.classList.add("d-none")}),[document.getElementById("btnBookmarkGroupAdd"),...document.getElementsByClassName("btnBookmarkGroupEdit"),document.getElementById("btnBookmarkSave"),document.getElementById("btnBookmarkReset"),...document.getElementsByClassName("btnBookmarkReorder"),...document.getElementsByClassName("btnBookmarkRemove")].forEach((t,e,o)=>{t.classList.remove("d-none")})):([document.getElementById("btnBookmarkEdit"),document.getElementById("btnBookmarkDownload"),document.getElementById("btnBookmarkUpload")].forEach((t,e,o)=>{t.classList.remove("d-none")}),[document.getElementById("btnBookmarkGroupAdd"),...document.getElementsByClassName("btnBookmarkGroupEdit"),document.getElementById("btnBookmarkSave"),document.getElementById("btnBookmarkReset"),...document.getElementsByClassName("btnBookmarkReorder"),...document.getElementsByClassName("btnBookmarkRemove")].forEach((t,e,o)=>{t.classList.add("d-none")}))},We=n=>{document.getElementById("groupNameInput").value.length>0&&(n=document.getElementById("groupNameInput").value,document.getElementById("groupNameInput").value="",nr.hide());const t=ke(`<div class="list-group-item group" data-group-name="${n}"><div class="d-flex flex-row align-items-center mb-2"><div class="flex-shrink-0"><i class="d-none bi bi-list btnBookmarkReorder" role="img" aria-hidden="true"></i></div><div class="flex-grow-1 ms-2"><b class="groupName">${n}</b></div><div class="flex-shrink-0"><button id="btnBookmarkEdit" class="d-none btn btn-sm btn-outline-secondary" type="button"><i class="bi bi-pencil" role="img" aria-label="編輯群組名稱"></i></button><button class="d-none btn btn-sm btn-danger btnBookmarkRemove" type="button" onclick="removeGroup(event)"><i class="bi bi-bookmark-dash" role="img" aria-label="移除群組"></i></button></div></div></div>`),e=ke('<div class="list-group route"></div>');t.appendChild(e),no.appendChild(t),new h(e,{handle:".btnBookmarkReorder",group:"route",animation:150})},or=n=>{n.target.closest("div.list-group-item.group").remove()},ro=(n,t,e=!1)=>{e&&(t=JSON.parse(re(t)));const o=ke(`<div class="list-group-item d-flex flex-row align-items-center" data-route-json="${$e(JSON.stringify(t))}" onclick="renderBookmarkStop(event)"><div class="flex-shrink-0"><i class="d-none bi bi-list btnBookmarkReorder" role="img" aria-hidden="true"></i> <img class="logo" src="${Me(t.company)}"/></div><div class="flex-grow-1 ms-3"><span class="badge text-bg-secondary">${t.route}</span> ${t.name}<br/><small class="text-secondary">${t.routeDesc}</small></div><div class="flex-shrink-0"><button class="d-none btn btn-sm btn-danger btnBookmarkRemove" type="button" onclick="removeBookmark(event)"><i class="bi bi-bookmark-dash" role="img" aria-label="移除已收藏路線"></i></button></div></div>`);document.querySelectorAll(`div[data-group-name="${n}"] .list-group.route`)[0].appendChild(o),e&&ao()},ir=n=>{n.target.closest("div.list-group-item").remove()},rr=()=>{Ye(!0)},ao=()=>{Ye(!1);const n=[...document.getElementsByClassName("list-group-item")].map(t=>{const e=t.getAttribute("data-group-name");if(e){const o=[...t.querySelectorAll(".list-group-item")].map(i=>re(i.getAttribute("data-route-json"))).join(oo);return JSON.stringify({[e]:o})}else return null}).filter(t=>!!t).join(io);localStorage.setItem("bookmarkList",n)},Ve=()=>{Ye(!1),no.innerHTML="";let n=[];localStorage.hasOwnProperty("bookmarkList")&&(n=localStorage.getItem("bookmarkList").split(io).map(t=>{const e=JSON.parse(t);return Object.entries(e).map(o=>({[o[0]]:o[1].split(oo).map(i=>JSON.parse(i))}))})),n.forEach(t=>{const e=Object.entries(t[0])[0];We(e[0]),e[1].forEach(o=>ro(e[0],o))})},ar=()=>{let n="";localStorage.hasOwnProperty("bookmarkList")&&(n=localStorage.getItem("bookmarkList"));let t=document.createElement("a"),e=new Blob([n],{type:"application/octet-stream"}),o=URL.createObjectURL(e);t.setAttribute("href",o),t.setAttribute("download","group"),t.click()},sr=n=>{const t=new FileReader;t.onload=e=>{localStorage.setItem("bookmarkList",e.target.result),Ve()},t.onerror=e=>console.error(e),t.readAsText(n.target.files[0])};document.getElementById("btnBookmarkEdit").onclick=rr;document.getElementById("btnBookmarkSave").onclick=ao;document.getElementById("btnBookmarkReset").onclick=Ve;document.getElementById("btnBookmarkGroupAddSubmit").onclick=We;document.getElementById("btnBookmarkDownload").onclick=ar;document.getElementById("fileUploadInput").addEventListener("change",sr,!1);Ve();new h(document.getElementById("bookmarkList"),{handle:".btnBookmarkReorder",group:"group",animation:150});window.addGroup=We;window.removeGroup=or;window.addBookmark=ro;window.removeBookmark=ir;
